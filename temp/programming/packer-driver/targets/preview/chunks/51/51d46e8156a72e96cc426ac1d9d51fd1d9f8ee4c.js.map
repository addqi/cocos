{"version":3,"sources":["file:///E:/cocos/project/CrazyGame/assets/res/scripts/battle/FightetModel.ts"],"names":["_decorator","AnimationClip","Component","Material","SkeletalAnimationComponent","SkinningModelComponent","ccclass","property","FightetModel","_fighter","_currentAni","_aniState","updateinfo","fighter","updateModel","team","index","i","model","length","_model","count","materials","arr","j","push","arrayMaterial","playAni","aniName","isLoop","callback","scheduleOnce","ani","play","getState","wrapMode","WrapMode","Loop","Normal","once","EventType","FINISHED"],"mappings":"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","sourcesContent":["import { _decorator, AnimationClip, Component, Material, Node, SkeletalAnimationComponent, SkeletalAnimationState, SkinningModelComponent } from 'cc';\r\nimport { Fighter } from './Fighter';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FightetModel')\r\nexport class FightetModel extends Component {\r\n    @property([SkinningModelComponent])\r\n    public model:SkinningModelComponent[] = [];\r\n    @property(SkeletalAnimationComponent)\r\n    public ani:SkeletalAnimationComponent = null!;\r\n\r\n    @property([Material])\r\n    public arrayMaterial:Material[] = [];\r\n    private _fighter:Fighter =null\r\n\r\n\r\n    private _currentAni:string = \"\"\r\n    private _aniState:SkeletalAnimationState;\r\n    public updateinfo(fighter:Fighter)\r\n    {\r\n        this._fighter = fighter;\r\n        this.updateModel(this._fighter.team)\r\n        // this.ani.play(\"idle\")\r\n    }\r\n\r\n    public updateModel(team)\r\n    {\r\n        let index=  0;\r\n        if(team == 1)\r\n        {\r\n            index = 1;\r\n        }else{\r\n            index = 0;\r\n        }\r\n        for(let i = 0;i<this.model.length;i++)\r\n        {\r\n            let _model = this.model[i];\r\n            if(_model)\r\n            {\r\n                let count = _model.materials.length;\r\n                let arr = [];\r\n                for(let j = 0;j<count;j++)\r\n                {\r\n                    arr.push(this.arrayMaterial[index]);\r\n                }\r\n                _model.materials = arr;\r\n            }\r\n        }\r\n    }\r\n\r\n    public playAni(aniName:string,isLoop:boolean = false,callback?:Function)\r\n    {\r\n        if(aniName==this._currentAni) return;\r\n        this._currentAni = aniName;\r\n        \r\n        this.scheduleOnce(()=>{\r\n            this.ani.play(aniName);\r\n            this._aniState = this.ani.getState(aniName) as SkeletalAnimationState;\r\n            if(this._aniState)\r\n            {\r\n                if(isLoop)\r\n                {\r\n                    this._aniState.wrapMode = AnimationClip.WrapMode.Loop;\r\n                }else\r\n                {\r\n                    this._aniState.wrapMode = AnimationClip.WrapMode.Normal;\r\n                }\r\n            }\r\n            \r\n            if(!isLoop)\r\n            {\r\n                this.ani.once(SkeletalAnimationComponent.EventType.FINISHED,()=>{\r\n                    this._currentAni = \"\";\r\n                    callback&&callback();\r\n                })\r\n            }\r\n        },0.1)\r\n        \r\n    }\r\n}\r\n\r\n\r\n"]}