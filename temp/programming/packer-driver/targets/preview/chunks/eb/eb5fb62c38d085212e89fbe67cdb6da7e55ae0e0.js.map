{"version":3,"sources":["file:///E:/cocos/project/CrazyGame/assets/res/scripts/manager/ConfigManager.ts"],"names":["_decorator","resources","CSVManager","ccclass","property","ConfigManager","csvManager","csvCount","currentLoadCount","instance","_instance","loadCsv","loadDir","err","assets","length","forEach","item","load","name","asset","console","log","message","text","addTable","checkLoadCsvFinish","queryAll","tableName","key","value"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuCC,MAAAA,S,OAAAA,S;;AACvCC,MAAAA,U,iBAAAA,U;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;+BAGjBK,a,WADZF,OAAO,CAAC,eAAD,C,2BAAR,MACaE,aADb,CAC2B;AAAA;AAAA,eAUvBC,UAVuB,GAUA;AAAA;AAAA,yCAVA;AAYvB;AAZuB,eAafC,QAbe,GAaG,CAbH;AAAA,eAcfC,gBAde,GAcU,CAdV;AAAA;;AAEJ,mBAARC,QAAQ,GAAE;AACjB,cAAG,KAAKC,SAAR,EACA;AACI,mBAAO,KAAKA,SAAZ;AACH;;AACD,eAAKA,SAAL,GAAiB,IAAIL,aAAJ,EAAjB;AACA,iBAAO,KAAKK,SAAZ;AACH;;AAMDC,QAAAA,OAAO,GACP;AACIV,UAAAA,SAAS,CAACW,OAAV,CAAkB,OAAlB,EAA0B,CAACC,GAAD,EAASC,MAAT,KAAkB;AACxC,gBAAGD,GAAH,EAAO;AACH;AACH;;AACD,iBAAKN,QAAL,GAAgBO,MAAM,CAACC,MAAvB;AACAD,YAAAA,MAAM,CAACE,OAAP,CAAgBC,IAAD,IAAQ;AACnBhB,cAAAA,SAAS,CAACiB,IAAV,CAAe,WAASD,IAAI,CAACE,IAA7B,EAAkC,CAACN,GAAD,EAAKO,KAAL,KAAiB;AAC/C,oBAAGP,GAAH,EACA;AACIQ,kBAAAA,OAAO,CAACC,GAAR,CAAYT,GAAG,CAACU,OAAJ,IAAaV,GAAzB;AACA;AACH;;AACD,oBAAIW,IAAI,GAAGJ,KAAK,CAACI,IAAjB;;AACA,oBAAGA,IAAH,EACA;AACE,uBAAKlB,UAAL,CAAgBmB,QAAhB,CAAyBR,IAAI,CAACE,IAA9B,EAAmCK,IAAnC;AAEE,uBAAKE,kBAAL;AACH;AACJ,eAbD;AAcH,aAfD;AAiBH,WAtBD;AAuBH;;AAEOA,QAAAA,kBAAkB,GAAE;AACxB,eAAKlB,gBAAL;;AACA,cAAG,KAAKA,gBAAL,IAAwB,KAAKD,QAAhC,EACA;AACIc,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACH;AACJ;;AAEMK,QAAAA,QAAQ,CAACC,SAAD,EAAmBC,GAAnB,EAA+BC,KAA/B,EAAyC;AACpD,iBAAO,KAAKxB,UAAL,CAAgBqB,QAAhB,CAAyBC,SAAzB,EAAmCC,GAAnC,EAAuCC,KAAvC,CAAP;AACH;;AApDsB,O,UAChBpB,S","sourcesContent":["import { _decorator, find, instantiate, Prefab, resources } from \"cc\";\r\nimport { CSVManager } from \"../utils/csvManager\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"ConfigManager\")\r\nexport class ConfigManager {\r\n    static _instance:ConfigManager;\r\n    static get instance(){\r\n        if(this._instance)\r\n        {\r\n            return this._instance;\r\n        }\r\n        this._instance = new ConfigManager();\r\n        return this._instance;\r\n    }\r\n    csvManager:CSVManager =new CSVManager();\r\n    \r\n    //加载表的总数\r\n    private csvCount:number = 0;\r\n    private currentLoadCount:number =0;\r\n    loadCsv()\r\n    {\r\n        resources.loadDir(\"datas\",(err:any,assets)=>{\r\n            if(err){\r\n                return;\r\n            }\r\n            this.csvCount = assets.length;\r\n            assets.forEach((item)=>{\r\n                resources.load(\"datas/\"+item.name,(err,asset:any)=>{\r\n                    if(err)\r\n                    {\r\n                        console.log(err.message||err);\r\n                        return;\r\n                    }\r\n                    let text = asset.text;\r\n                    if(text)\r\n                    {\r\n                      this.csvManager.addTable(item.name,text);\r\n\r\n                        this.checkLoadCsvFinish();\r\n                    }\r\n                })\r\n            })\r\n            \r\n        })\r\n    }\r\n\r\n    private checkLoadCsvFinish(){\r\n        this.currentLoadCount++;\r\n        if(this.currentLoadCount>= this.csvCount)\r\n        {\r\n            console.log(\"表格加载完成\")\r\n        }\r\n    }\r\n\r\n    public queryAll(tableName:string, key:string, value:any){\r\n        return this.csvManager.queryAll(tableName,key,value);\r\n    }\r\n\r\n}"]}