{"version":3,"sources":["file:///E:/cocos/project/CrazyGame/assets/script/manager/ConfigManager.ts"],"names":["_decorator","Component","resources","CSVManager","ccclass","property","ConfigManager","csvManager","csvCount","currentLoadCount","instance","_instance","loadCsv","loadDir","err","assets","length","forEach","item","load","name","asset","console","log","message","text","addTable","checkLoadCsvFinish","queryAll","tableName","key","value"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,S,OAAAA,S;;AAC7BC,MAAAA,U,iBAAAA,U;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;+BAGjBM,a,WADZF,OAAO,CAAC,eAAD,C,2BAAR,MACaE,aADb,SACmCL,SADnC,CAC6C;AAAA;AAAA;AAAA,eAgBzCM,UAhByC,GAgBnB;AAAA;AAAA,yCAhBmB;AAmBzC;AAnByC,eAoBjCC,QApBiC,GAoBjB,CApBiB;AAAA,eAqBjCC,gBArBiC,GAqBT,CArBS;AAAA;;AAEtB,mBAARC,QAAQ,GAAE;AACjB;AACA;AACA;AACA;AACA;AACA,cAAI,CAACJ,aAAa,CAACK,SAAnB,EAA8B;AAAE;AAC5BL,YAAAA,aAAa,CAACK,SAAd,GAA0B,IAAIL,aAAJ,EAA1B,CAD0B,CAE1B;;AACAA,YAAAA,aAAa,CAACK,SAAd,CAAwBC,OAAxB;AACH;;AACD,iBAAON,aAAa,CAACK,SAArB,CAXiB,CAWe;AACnC;;AAQDC,QAAAA,OAAO,GAAE;AACLV,UAAAA,SAAS,CAACW,OAAV,CAAkB,OAAlB,EAA0B,CAACC,GAAD,EAASC,MAAT,KAAkB;AACxC,gBAAGD,GAAH,EAAO;AACH;AACH;;AACD,iBAAKN,QAAL,GAAgBO,MAAM,CAACC,MAAvB;AACAD,YAAAA,MAAM,CAACE,OAAP,CAAgBC,IAAD,IAAQ;AACnBhB,cAAAA,SAAS,CAACiB,IAAV,CAAe,WAASD,IAAI,CAACE,IAA7B,EAAkC,CAACN,GAAD,EAAKO,KAAL,KAAiB;AAC/C,oBAAGP,GAAH,EACA;AACIQ,kBAAAA,OAAO,CAACC,GAAR,CAAYT,GAAG,CAACU,OAAJ,IAAaV,GAAzB;AACA;AACH;;AACD,oBAAIW,IAAI,GAAGJ,KAAK,CAACI,IAAjB;;AACA,oBAAGA,IAAH,EAAQ;AACJ,uBAAKlB,UAAL,CAAgBmB,QAAhB,CAAyBR,IAAI,CAACE,IAA9B,EAAmCK,IAAnC;AAEA,uBAAKE,kBAAL;AACH;AACJ,eAZD;AAaH,aAdD;AAeH,WApBD;AAqBH;;AAEOA,QAAAA,kBAAkB,GAAE;AACzB,eAAKlB,gBAAL;;AACA,cAAG,KAAKA,gBAAL,IAAwB,KAAKD,QAAhC,EAAyC;AACpCc,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACJ;AACH;;AAEMK,QAAAA,QAAQ,CAAEC,SAAF,EAAoBC,GAApB,EAAgCC,KAAhC,EAA2C;AACtD,iBAAO,KAAKxB,UAAL,CAAgBqB,QAAhB,CAAyBC,SAAzB,EAAoCC,GAApC,EAAyCC,KAAzC,CAAP;AACH;;AAvDwC,O,UAClCpB,S","sourcesContent":["import { _decorator, Component, Node, resources, TiledObjectGroup, toDegree } from 'cc';\r\nimport { CSVManager } from '../utils/csvManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ConfigManager')\r\nexport class ConfigManager extends Component {\r\n    static _instance:ConfigManager;\r\n    static get instance(){\r\n        // if(this._instance){\r\n        //     return\r\n        // }\r\n        // this._instance = new ConfigManager();\r\n        // return this._instance;\r\n        if (!ConfigManager._instance) { // 检查是否已初始化\r\n            ConfigManager._instance = new ConfigManager();\r\n            // 可选：在此处初始化必要数据（如加载 CSV）\r\n            ConfigManager._instance.loadCsv();\r\n        }\r\n        return ConfigManager._instance; // 确保返回实例\r\n    }\r\n\r\n    csvManager:CSVManager=new CSVManager();\r\n\r\n\r\n    //加载表的总数\r\n    private csvCount:number=0;\r\n    private currentLoadCount:number=0;\r\n    loadCsv(){\r\n        resources.loadDir(\"datas\",(err:any,assets)=>{\r\n            if(err){\r\n                return;\r\n            }\r\n            this.csvCount = assets.length;\r\n            assets.forEach((item)=>{\r\n                resources.load(\"datas/\"+item.name,(err,asset:any)=>{\r\n                    if(err)\r\n                    {\r\n                        console.log(err.message||err);\r\n                        return;\r\n                    }\r\n                    let text = asset.text;\r\n                    if(text){\r\n                        this.csvManager.addTable(item.name,text);\r\n\r\n                        this.checkLoadCsvFinish();\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    private checkLoadCsvFinish(){\r\n       this.currentLoadCount++;\r\n       if(this.currentLoadCount>= this.csvCount){\r\n            console.log(\"表格加载完成\")\r\n       }\r\n    }\r\n\r\n    public queryAll (tableName:string, key:string, value:any) {\r\n        return this.csvManager.queryAll(tableName, key, value);\r\n    }\r\n}\r\n\r\n\r\n"]}