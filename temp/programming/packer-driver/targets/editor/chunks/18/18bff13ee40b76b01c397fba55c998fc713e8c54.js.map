{"version":3,"sources":["file:///E:/cocos/project/CrazyGame/assets/script/battle/SoliderModel.ts"],"names":["_decorator","Component","Material","SkeletalAnimation","SkinnedMeshRenderer","AnimationClip","ccclass","property","SoliderModel","solider","_currentAni","_aniState","updateInfo","updateModel","team","ani","play","model","material","skin","playAni","aniName","isLoop","callback","console","log","node","getComponent","error","getState","wrapMode","WrapMode","Loop","Normal","once","EventType","FINISHED"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Q,OAAAA,Q;AAAgBC,MAAAA,iB,OAAAA,iB;AAA2CC,MAAAA,mB,OAAAA,mB;AAAqBC,MAAAA,a,OAAAA,a;;;;;;;;;OAE1G;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;8BAGjBQ,Y,WADZF,OAAO,CAAC,cAAD,C,UAEHC,QAAQ,CAACH,mBAAD,C,UAGRG,QAAQ,CAAC,CAACL,QAAD,CAAD,C,UAERK,QAAQ,CAACJ,iBAAD,C,2BAPb,MACaK,YADb,SACkCP,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eASxCQ,OATwC;AAAA,eAUxCC,WAVwC;AAAA,eAWxCC,SAXwC,GAWJ,IAXI;AAAA;;AAaxCC,QAAAA,UAAU,CAACH,OAAD,EAAmB;AACzB,eAAKA,OAAL,GAAeA,OAAf;AACA,eAAKI,WAAL,CAAiBJ,OAAO,CAACK,IAAzB;AACA,eAAKC,GAAL,CAASC,IAAT,CAAc,MAAd;AACH;;AAEDH,QAAAA,WAAW,CAACC,IAAD,EAAe;AACtB;AACA,cAAIA,IAAI,IAAI,CAAZ,EAAe;AACX,iBAAKG,KAAL,CAAW,CAAX,EAAcC,QAAd,GAAyB,KAAKC,IAAL,CAAU,CAAV,CAAzB;AACH,WAFD,MAGK,IAAIL,IAAI,IAAI,CAAZ,EAAe;AAChB,iBAAKG,KAAL,CAAW,CAAX,EAAcC,QAAd,GAAyB,KAAKC,IAAL,CAAU,CAAV,CAAzB;AACH;AACJ;;AAEMC,QAAAA,OAAO,CAACC,OAAD,EAAkBC,MAAe,GAAG,KAApC,EAA2CC,QAA3C,EAAgE;AAC1E,cAAIF,OAAO,IAAI,KAAKX,WAApB,EAAiC;AAC7Bc,YAAAA,OAAO,CAACC,GAAR,CAAY,aAAa,KAAKf,WAA9B;AACA;AACH;;AACD,eAAKA,WAAL,GAAmBW,OAAnB;;AACA,cAAI,CAAC,KAAKN,GAAV,EAAe;AACX,iBAAKA,GAAL,GAAW,KAAKW,IAAL,CAAUC,YAAV,CAAuBxB,iBAAvB,CAAX;AACAqB,YAAAA,OAAO,CAACI,KAAR,CAAc,UAAd;AACH;;AAED,eAAKb,GAAL,CAASC,IAAT,CAAcK,OAAd;AACA,eAAKV,SAAL,GAAiB,KAAKI,GAAL,CAASc,QAAT,CAAkBR,OAAlB,CAAjB;;AACA,cAAI,KAAKV,SAAT,EAAoB;AAChB,gBAAIW,MAAJ,EAAY;AACR,mBAAKX,SAAL,CAAemB,QAAf,GAA0BzB,aAAa,CAAC0B,QAAd,CAAuBC,IAAjD;AACAR,cAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACH,aAHD,MAGO;AACH,mBAAKd,SAAL,CAAemB,QAAf,GAA0BzB,aAAa,CAAC0B,QAAd,CAAuBE,MAAjD;AACAT,cAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACA,mBAAKV,GAAL,CAASmB,IAAT,CAAc/B,iBAAiB,CAACgC,SAAlB,CAA4BC,QAA1C,EAAmD,MAAI;AACnD,qBAAK1B,WAAL,GAAmB,EAAnB;AACAa,gBAAAA,QAAQ,IAAEA,QAAQ,EAAlB;AACH,eAHD;AAIH;AACJ;AACJ;;AAvDuC,O;;;;;iBAET,E;;;;;;;iBAGZ,E;;;;;;;iBAEM,I","sourcesContent":["import { _decorator, Component, Material, Node, SkeletalAnimation, SkeletalAnimationState, SkinnedMeshRenderer, AnimationClip } from 'cc';\r\nimport { Solider } from '../Solider';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SoliderModel')\r\nexport class SoliderModel extends Component {\r\n    @property(SkinnedMeshRenderer)\r\n    model: SkinnedMeshRenderer[] = [];\r\n\r\n    @property([Material])\r\n    skin: Material[] = [];\r\n    @property(SkeletalAnimation)\r\n    ani: SkeletalAnimation = null;\r\n\r\n    solider: Solider;\r\n    _currentAni: string;\r\n    _aniState: SkeletalAnimationState = null;\r\n\r\n    updateInfo(solider: Solider) {\r\n        this.solider = solider;\r\n        this.updateModel(solider.team);\r\n        this.ani.play(\"idle\");\r\n    }\r\n\r\n    updateModel(team: number) {\r\n        // console.log(\"更新小兵皮肤\");\r\n        if (team == 1) {\r\n            this.model[0].material = this.skin[0];\r\n        }\r\n        else if (team == 2) {\r\n            this.model[0].material = this.skin[1];\r\n        }\r\n    }\r\n\r\n    public playAni(aniName: string, isLoop: boolean = false, callback?: Function) {\r\n        if (aniName == this._currentAni) {\r\n            console.log(\"当前播放的动画是\" + this._currentAni);\r\n            return;\r\n        }\r\n        this._currentAni = aniName;\r\n        if (!this.ani) {\r\n            this.ani = this.node.getComponent(SkeletalAnimation);\r\n            console.error(\"没有找到动画组件\");\r\n        }\r\n\r\n        this.ani.play(aniName);\r\n        this._aniState = this.ani.getState(aniName) as SkeletalAnimationState;\r\n        if (this._aniState) {\r\n            if (isLoop) {\r\n                this._aniState.wrapMode = AnimationClip.WrapMode.Loop;\r\n                console.log(\"循环播放\");\r\n            } else {\r\n                this._aniState.wrapMode = AnimationClip.WrapMode.Normal;\r\n                console.log(\"播放一次\");\r\n                this.ani.once(SkeletalAnimation.EventType.FINISHED,()=>{\r\n                    this._currentAni = \"\";\r\n                    callback&&callback();\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n}\r\n\r\n\r\n"]}